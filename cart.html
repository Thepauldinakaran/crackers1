<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF and jsPDF AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
      .remove-button {
        cursor: pointer;
        color: red;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <!-- Top Bar with Running Diwali Sale Message -->
    <div class="bg-red-600 text-white py-2 flex justify-center">
      <marquee behavior="scroll" direction="left">
        ðŸŽ‰ Diwali Sales Here! Get the Best Deals Now! ðŸŽ‰
      </marquee>
    </div>

    <!-- Logo and Contact Info Section -->
    <div
      class="py-5 px-6 shadow-md flex justify-between items-center bg-white bg-opacity-90"
    >
      <div class="flex items-center">
        <!-- Replace with your logo -->
        <img
          src="./image/name logo.png"
          alt="Logo"
          class="w-[100px] h-[100px]"
        />
        <div class="ml-4 md:ml-10">
          <p class="font-bold text-xl">Sivakasi Crackers</p>
          <p class="text-gray-800 text-md">
            13/374/14 Sivakasi Main Road, kutty japan, Sivakasi - 626189
          </p>
        </div>
      </div>
      <!-- Contact Info -->
      <div class="hidden md:flex space-x-6">
        <div class="flex items-center">
          <img src="./image/phone.png" alt="Phone" class="w-6 h-6 mr-2" />
          <p class="font-bold text-lg">+91-9876543210</p>
        </div>
        <div class="flex items-center">
          <img src="./image/email_icon.png" alt="Email" class="w-6 h-6 mr-2" />
          <p class="font-bold text-lg">sivakasicrackers@gmail.com</p>
        </div>
      </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="bg-purple-900 text-white py-4 sticky top-0 z-50">
      <div
        class="container mx-auto flex justify-between items-center px-4 md:px-0"
      >
        <!-- Sivakasi Crackers Brand Name on Left -->
        <div class="text-lg font-bold md:hidden">Sivakasi Crackers</div>

        <!-- Full Navbar for desktop and tablet -->
        <ul class="hidden md:flex space-x-6">
          <li>
            <a href="home.html" class="hover:text-yellow-400 font-bold">Home</a>
          </li>
          <li>
            <a href="about.html" class="hover:text-yellow-400 font-bold"
              >About</a
            >
          </li>
          <li>
            <a href="product.html" class="hover:text-yellow-400 font-bold"
              >Products</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-yellow-400 font-bold">Safety Tips</a>
          </li>
          <li>
            <a href="#" class="hover:text-yellow-400 font-bold">Contact</a>
          </li>
        </ul>
        <button
          class="hidden md:block bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-bold"
        >
          Download Pricelist
        </button>

        <!-- Hamburger Menu on Right for mobile view -->
        <div class="md:hidden">
          <button id="menu-btn" class="text-white focus:outline-none">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Menu (Initially hidden) -->
      <div
        id="mobile-menu"
        class="fixed right-0 top-0 bottom-0 w-64 z-50 h-screen bg-rose-50 transition-transform duration-500 translate-x-full md:hidden dark:bg-[#2a004a] dark:text-white"
      >
        <div class="flex justify-end p-4">
          <button id="close-menu" class="text-white focus:outline-none">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <ul class="flex flex-col items-center space-y-4 mt-4">
          <li>
            <a href="home.html" class="hover:text-yellow-400 font-bold">Home</a>
          </li>
          <li>
            <a href="about.html" class="hover:text-yellow-400 font-bold"
              >About</a
            >
          </li>
          <li>
            <a href="product.html" class="hover:text-yellow-400 font-bold"
              >Products</a
            >
          </li>
          <li>
            <a href="#" class="hover:text-yellow-400 font-bold">Safety Tips</a>
          </li>
          <li>
            <a href="#" class="hover:text-yellow-400 font-bold">Contact</a>
          </li>
          <button
            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-bold"
          >
            Download Pricelist
          </button>
        </ul>
      </div>
    </nav>

    <!-- JS for Menu -->

    <!-- Hero Section with Diwali Sale Image -->

    <!-- WhatsApp Floating Button -->
    <a
      href="https://wa.me/911234567890"
      target="_blank"
      class="fixed bottom-4 left-4 z-[1100]"
    >
      <img
        src="./image/whatsapp-logo-png.png"
        alt="WhatsApp"
        class="h-12 w-12"
      />
    </a>
    <div class="container mx-auto mt-6 px-4">
      <h2 class="text-xl sm:text-2xl font-bold mb-4">Cart</h2>

      <!-- Cart Table -->
      <div class="overflow-x-auto">
        <table
          class="min-w-full bg-white border border-gray-300 text-[8px] sm:text-base"
        >
          <thead>
            <tr class="bg-gray-200 text-xs sm:text-sm">
              <th class="py-1 px-2 border">Product Name</th>
              <th class="py-1 px-2 border">Price</th>
              <th class="py-1 px-2 border">Qty</th>
              <th class="py-1 px-2 border">Total</th>
              <th class="py-1 px-2 border">Remove</th>
            </tr>
          </thead>
          <tbody id="cart-list"></tbody>
        </table>
      </div>

      <!-- Summary -->
      <div class="mt-6 bg-white p-4 shadow-md rounded">
        <h3 class="text-lg font-bold mb-4">Summary</h3>
        <p>Total Products: <span id="total-products">0</span></p>
        <p>Total Items: <span id="total-items">0</span></p>
        <p>Total Save: Rs.<span id="total-save">0.00</span></p>
        <p>Overall Total: Rs.<span id="overall-total">0.00</span></p>
      </div>

      <!-- Customer Form -->
      <div class="mt-6">
        <h3 class="text-lg font-bold mb-4">Customer Details</h3>
        <form id="checkout-form">
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
            <input
              type="text"
              id="name"
              placeholder="Name"
              required
              class="border px-4 py-2 w-full"
            />
            <input
              type="email"
              id="email"
              placeholder="Email"
              required
              class="border px-4 py-2 w-full"
            />
            <input
              type="text"
              id="mobile"
              placeholder="Mobile"
              required
              class="border px-4 py-2 w-full"
            />
            <input
              type="text"
              id="address"
              placeholder="Address"
              required
              class="border px-4 py-2 w-full"
            />
          </div>
          <div
            class="mt-4 flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4"
          >
            <button
              type="submit"
              class="bg-green-500 text-white py-2 px-4 rounded w-full sm:w-auto mb-3"
            >
              Place Order
            </button>
            <!-- Success Message -->
            <span id="success-message" class="text-green-600 hidden">
              Order placed successfully!
            </span>
          </div>
        </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const cartList = document.getElementById("cart-list");
        const quantities = JSON.parse(localStorage.getItem("cartItems")) || {};
        let overallTotal = 0;

        function displayCartItems() {
          cartList.innerHTML = "";

          Object.keys(quantities).forEach((productKey) => {
            const product = quantities[productKey];
            const row = document.createElement("tr");

            row.innerHTML = `
              <td class="py-1 px-2 border">${product.name}</td>
              <td class="py-1 px-2 border">Rs.${product.price.toFixed(2)}</td>
              <td class="py-1 px-2 border">${product.quantity}</td>
              <td class="py-1 px-2 border">Rs.${(
                product.price * product.quantity
              ).toFixed(2)}</td>
              <td class="py-1 px-2 border text-center">
                <button class="remove-button" data-product="${productKey}">Remove</button>
              </td>
            `;

            cartList.appendChild(row);
          });

          bindRemoveButtons();
          updateSummary();
        }

        function bindRemoveButtons() {
          const removeButtons = document.querySelectorAll(".remove-button");

          removeButtons.forEach((button) => {
            button.addEventListener("click", (event) => {
              const productKey = event.target.getAttribute("data-product");
              removeProductFromCart(productKey);
              displayCartItems();
            });
          });
        }

        function removeProductFromCart(productKey) {
          // Remove product from cartItems and update localStorage
          delete quantities[productKey];
          localStorage.setItem("cartItems", JSON.stringify(quantities));

          // Reset the product quantity in product.html
          const productQuantities =
            JSON.parse(localStorage.getItem("productQuantities")) || {};
          if (productQuantities[productKey]) {
            productQuantities[productKey] = 0; // Reset the quantity to 0
            localStorage.setItem(
              "productQuantities",
              JSON.stringify(productQuantities)
            );
          }
        }

        function updateSummary() {
          const totalProducts = Object.keys(quantities).length;
          const totalItems = Object.values(quantities).reduce(
            (acc, prod) => acc + prod.quantity,
            0
          );
          overallTotal = 0;
          let totalSave = 0;

          Object.values(quantities).forEach((prod) => {
            const totalPrice = prod.price * prod.quantity;
            overallTotal += totalPrice;
            totalSave += (prod.originalPrice - prod.price) * prod.quantity;
          });

          document.getElementById("total-products").textContent = totalProducts;
          document.getElementById("total-items").textContent = totalItems;
          document.getElementById("total-save").textContent =
            totalSave.toFixed(2);
          document.getElementById("overall-total").textContent =
            overallTotal.toFixed(2);
        }

        function generatePDF() {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // Add heading
          doc.setFontSize(16);
          doc.setFont("helvetica", "bold");
          doc.text("Sivakasi Crackers", 105, 10, null, null, "center");
          doc.setFontSize(12);
          doc.setFont("helvetica", "normal");
          doc.text(
            "Sivakasi Kutty Japan-666777",
            105,
            18,
            null,
            null,
            "center"
          );
          doc.text("Phone: 9876543210", 105, 24, null, null, "center");

          // Customer details
          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const mobile = document.getElementById("mobile").value;
          const address = document.getElementById("address").value;

          doc.setFontSize(12);
          doc.text("Customer Details:", 10, 40);
          doc.text(`Name: ${name}`, 10, 46);
          doc.text(`Email: ${email}`, 10, 52);
          doc.text(`Mobile: ${mobile}`, 10, 58);
          doc.text(`Address: ${address}`, 10, 64);

          // Product table
          let startY = 80;
          doc.text("Product List", 10, startY - 6);
          doc.autoTable({
            startY: startY,
            head: [["Product Name", "Price (Rs.)", "Qty", "Total (Rs.)"]],
            body: Object.values(quantities).map((prod) => [
              prod.name,
              `Rs.${prod.price.toFixed(2)}`,
              prod.quantity,
              `Rs.${(prod.price * prod.quantity).toFixed(2)}`,
            ]),
            theme: "grid",
            didDrawPage: (data) => {
              startY = data.cursor.y; // Update the starting point for the next page if overflow
            },
          });

          // Add overall total
          doc.text(
            `Overall Total: Rs.${overallTotal.toFixed(2)}`,
            10,
            startY + 10
          );

          // Save the PDF
          doc.save("order_summary.pdf");
        }

        document
          .getElementById("checkout-form")
          .addEventListener("submit", (event) => {
            event.preventDefault();

            if (Object.keys(quantities).length === 0) {
              alert("Please add products to the cart before placing an order.");
              return;
            }

            generatePDF(); // Generate PDF on form submission
            document
              .getElementById("success-message")
              .classList.remove("hidden");
            clearAllQuantities();
            setTimeout(() => {
              window.location.href = "product.html";
            }, 2000);
          });

        function clearAllQuantities() {
          // Clear all product quantities from localStorage
          localStorage.removeItem("cartItems");
          const productQuantities =
            JSON.parse(localStorage.getItem("productQuantities")) || {};
          Object.keys(productQuantities).forEach((key) => {
            productQuantities[key] = 0; // Reset all product quantities to 0
          });
          localStorage.setItem(
            "productQuantities",
            JSON.stringify(productQuantities)
          );
        }

        displayCartItems();
      });
    </script>

    <!-- Footer Information -->
    <div
      class="bg-yellow-200 text-center py-5 text-[10px] text-gray-700 px-4 md:px-10 sm:text-sm"
    >
      <p class="px-4 md:px-10">
        As per 2018 supreme court order, online sale of firecrackers are not
        permitted! We value our customers and at the same time, respect
        jurisdiction. We request you to add your products to the cart and submit
        the required crackers through the enquiry button...
      </p>
      <p>Â© 2024 Sivakasi Crackers. All rights reserved.</p>
    </div>
    <script src="script.js"></script>
  </body>
</html>
